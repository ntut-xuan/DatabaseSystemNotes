# 資料庫系統筆記 Ch. 3

> 參考書籍：
>
> 1. 《Databases System 7th Edition》─ Ramez Elmasri, Shamkant B. Navathe.
> 2. 《數據庫系統基礎 第六版》─ Ramez Elmasri, Shamkant B. Navathe，李翔鷹、劉鑌、邱海艷、陳立軍譯
>
> 筆記作者：[黃漢軒](https://ntut-xuan.github.io)



## 使用高階概念資料模型來進行資料庫規劃

下圖為簡化的資料庫設計概念：

- 先從一些特定主題的集合（Miniworld）開始，進行「需求集合與分析」（Requirements collection and analysis）。
- 有了函數需求（Functional Analysis）之後就能夠進入函數分析（Functional Analysis）
- 有了資料需求（Data Requirements）之後就能夠進入概念設計（Conceptual Design）
  - 從概念設計取得概念模式（Conceptual Schema），在這邊會得到 ER Diagram。
  - 從概念模式取得邏輯設計，得到邏輯模式（Logical Schema）。
  - 接著硬體設計並得到內層模式（Internal Schema）。

<img src="https://i.imgur.com/VpZsSj1.png" alt="image-20221020082217748" style="zoom: 67%;" />



## 實體關係模型與實體關係圖

我們使用實體關係圖（Entity Relational Diagram, ER Diagram），來描述我們的實體關係模型（Entity Relational Model, ER Model），如下圖。

實體關係模型（ER Model）通常拿來描述概念資料模型（Conceptual Model），用來在特定系統中定義實體與關係。

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/ER_Diagram_MMORPG.png/1024px-ER_Diagram_MMORPG.png" alt="img" style="zoom: 50%;" />



## 實體型態、實體集、屬性與鍵

### 定義實體

- 通常泛指一個獨立存在於現實生活中的事件或物件。
  - 現實生活中的物件，通常是物理上的存在，例如：學生、教授...
  - 現實生活中的事件，通常是概念上的存在，例如：課程、工作...
- 實體具有多個屬性，例如學生具有名稱、學號等等。
  - 屬性又可詳細分成了以下七種不同的屬性：
    - 單值 vs 多值：
      - 單值屬性（Simple Attribute）：只有一個值，例如學號。
      - 多值數性（Multivalued Attribute）：用來儲存兩種以上的值的屬性，例如汽車的顏色。
    - 單元 vs 複合
      - 單元屬性（Atomic Attribute）：單一一種屬性，不可再切割，例如鄉鎮市區。
      - 複合屬性（Composite Attribute）：由兩個以上的屬性所組成，例如地址。
    - 儲存 vs 衍生
      - 儲存屬性（Stored Attribute）：可藉由衍生屬性進行推論的資料，例如出生年月日。
      - 衍生屬性（Derived Attribute）：由某種方式推論而成，例如利用出生年月日來推論出年紀。
- 每個屬性具有值，因此我們就能使用這樣的方式來定義實體。



### 實體型態與實體集

- 實體型態即為一個具有相同屬性的實體集合。
  - 可以想像成學校內的學生具有相同屬性，學校內的課程具有相同屬性。
- 在某特定時間內，選擇某特定實體型態得到一集合，稱為實體集或實體集合。
- 實體型態會呈現在 ER Diagram 上，以一個正方形方格來呈現實體型態。



### 鍵屬性與實體型態

- 鍵屬性是一種在實體型態上的屬性，代表在實體集上，每個實體的鍵屬性值都是不同的，用來識別實體單一性。
- 一個實體可能會有多個鍵屬性，代表在實體集上，每個實體的鍵屬性值組合都會是不同的。
- 若一個屬性具有底線，則代表該屬性是鍵屬性。



### 屬性值域

用來代表該屬性的值域，通常具有一個資料型態，例如 `TEXT`、`INTEGER` 等等。

通常若我們有多個屬性作交集，其值域可能會縮小，以數學上定義就像取集合一樣。



## 關聯型態、關聯集、角色與結構限制

在 ER Diagram 中，表達兩個實體的關係不應該使用屬性來表達，而是使用關聯。



### 關聯型態、集合與實例

- 關聯型態（Relationship Type, $R$）指的是 $n$ 個實體型態 $E_1, E_2, ..., E_n$ 之間的關聯。
- 關聯集合（Relationship Set）指的是一個關聯型態中，這些 $n$ 個實體型態之間的所有對應關係，所組成的集合。
- 關聯實例（Relationship Instance）指的是與多個實體型態的關聯。

<img src="https://i.imgur.com/lawVBhq.png" alt="image-20221025015719326" style="zoom:67%;" />

例如上圖所述，每個學生都會被分到至少一位教授，教授可以選擇多位學生進行指導，關聯就如同上圖。

其中學生 $e_1, e_2, ... e_7$ 所形成的集合與指導教授 $d_1, d_2, d_3 ...$ 所形成的集合為實體型態，

其中 $r_1, r_2, ... r_n$ 所形成的集合即為關聯集合，「專題指導」這個關聯即為關聯型態，單一一個關聯 $r_i$ 即為關聯實例。

其中學生與教授的實體型態，在關聯關係中被稱為參與者（Participate）



### 關聯維度、角色名稱與遞迴關係

- 關聯維度：指的是一個關聯中，所關聯的實體型態數量
  - 例如：如上圖所示，其關聯維度為 $2$，因為只有學生與老師兩個實體型態。
  - 通常來說若關聯維度為 $2$ 則稱為二元關係（Binary）、$3$ 則為三元關係（Ternary）。
- 角色名稱：指的是一個關聯中，實體型態所代表的名稱
  - 例如：如上圖所示，學生所代表的角色名稱即為學生（或者被指導的學生），而教授即為教授（或者指導教授）
  - 實務上其實不一定需要，但對於同一個實體型態來說，實體與集合內另一個實體具有關係時，就稱為遞迴關係。
- 遞迴關係：對於兩個來自於相似的實體型態所造成的關係，稱為遞迴關係或自參考關係。
  - 例如：如下圖所示，一個讀書會中學生 $a_1$ 監督學生 $a_2$，就會具有監督（綠色）與被監督（紫粉色）兩種不同的角色名稱。

<img src="https://i.imgur.com/4bTsoR1.png" alt="image-20221025021908054" style="zoom: 50%;" />



### 對於二元關係的約束

- 約束比，分為 $1:1$（一對一）、$1:M$（一對多）或 $N:1$（多對一）、$N:M$（多對多）三種。
  - 一對一：例如結婚就是一對一的關係。
  - 一對多或多對一：例如教授可以教多門課。
  - 多對多：例如學生可以加選多門課，每門課都有多個學生的資料。

- 參與者約束，用於約束一個實體型態與另一個實體型態關係中，所參與的實例有幾個。
  - 約束最小關聯的數量，稱為最小基數約束（Minimum Cardinality Constraint）。
  - 約束最大關聯的數量，稱為最大基數約束（Maximum Cardinality Constraint）。
- 參與者約束，具有兩種不同的類別：
  - 總約束：對於每個實體中的每一個實例，至少與關聯中的關聯實例有關聯，使用兩條線來連接關聯。
  - 部分約束：對於每個實體中的部分實例與關聯實例有關連，使用一條線來連接關聯。

- 我們使用結構約束，也就是使用約束比與參與者約束來約束關聯。



### 關聯型態的屬性

- 關聯型態可以具有屬性，例如「每位教授 T 指導 Q 位學生 S」，我們就會將指導學生的數量使用屬性來記錄。



## 弱實體型態

- 弱實體型態的定義
  - 對於一個沒有主鍵的實體，我們稱為該實體為弱實體型態，反之則為強實體型態。
- 強實體型態與弱實體型態
  - 對於一個強實體型態，擁有弱實體型態，則稱該強實體型態為「識別實體型態（Identify Entity Type）」。
  - 對於一個強實體型態與弱實體型態的關聯，我們稱該關聯為「識別關聯（Identify Relationship）」。
- 弱實體型態的屬性
  - 必為總約束，因為若沒有識別型態，弱實體無法保持識別性。
  - 具有部分鍵，用來與識別實體具有關聯性。
- 弱實體使用雙線（double line）來畫實體格子，弱關聯使用雙線（double line）來畫關聯菱形。
- 部分鍵使用虛線（dash line）來畫鍵底線。
- 弱實體類別，可表現成複雜屬性，取決於設計者。



## ER Diagram 規範與命名規範

### ER Diagram 命名規範

- 對於實體型態，使用單數名稱，例如 `STUDENT` 而不是 `STUDENTS`
- 對於關聯型態與實體型態，使用全大寫名稱，例如 `STUDENT` 而不是 `Student`。
- 對於屬性名稱，第一個字母大寫，其餘小寫或底線，例如 `Address`。
- 角色名稱使用全小寫，例如 `supervisor`。
- 對於實體型態，使用名詞來進行命名，對於關聯，使用動詞來進行命名，屬性通常使用名詞。



### ER Diagram 符號使用

<img src="https://i.imgur.com/J7JmjO9.png" alt="image-20221025152054507" style="zoom: 80%;" />



## 二元關係與三元、多元關係

> 待補。